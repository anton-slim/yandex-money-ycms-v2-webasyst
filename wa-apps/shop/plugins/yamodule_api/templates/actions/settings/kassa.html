<form action="?module=plugins&id=yamodule_api&action=save&mode=kassa" method="post" id="plugins-settings-form">
    <div class="field">
        <div class="name">

        </div>
        <div class="value">
            Для работы с модулем нужно подключить магазин к <a target="_blank" href="https://kassa.yandex.ru/">Яндекс.Кассе</a>.
        </div>
    </div>
    <div class="field">
        <div class="name">
            <label for=""></label>
        </div>
        <div class="value">
            <input {if $ya_kassa_active} checked="checked" {/if} id="ya_kassa_active" type="checkbox"
            name="ya_kassa_active" class="input ya-active" value="1">
            <label for="ya_kassa_active">[`Включить приём платежей через Яндекс.Кассу`]</label><br/>
        </div>
    </div>

    <div class="field">
        <div class="name">
            <label for="ya_kassa_shopid">[`shop ID`]</label>
        </div>
        <div class="value">
            <input id="ya_kassa_shopid" type="text" name="ya_kassa_shopid" class="input" value="{$ya_kassa_shopid}">
            <br><span class="help-block">[`Скопируйте shopId из личного кабинета Яндекс.Кассы`]</span>
        </div>
    </div>
    <div class="field">
        <div class="name">
            <label for="ya_kassa_pw">[`Секретный ключ`]</label>
        </div>
        <div class="value">
            <input id="ya_kassa_pw" type="text" name="ya_kassa_pw" class="input" value="{$ya_kassa_pw}">
            <br><span class="help-block">[`Выпустите и активируйте секретный ключ в личном кабинете Яндекс.Кассы. Потом скопируйте его сюда.`]</span>
        </div>
    </div>
    <div class="field">
        <div class="name">
            <label for="">[`Выбор способа оплаты`]</label>
        </div>
        <div class="value">
            <input {if !$ya_kassa_inside} checked="checked" {/if} id="ya_kassa_inside" type="radio"
            name="ya_kassa_inside" class="input" value="0">
            <label for="ya_kassa_inside">[`На стороне Кассы`]</label><br/>
            <input {if $ya_kassa_inside} checked="checked" {/if} id="ya_kassa_inside" type="radio"
            name="ya_kassa_inside" class="input" value="1">
            <label for="ya_kassa_inside">[`На стороне магазина`]</label><br/>
        </div>
    </div>
    <div class="field">
        <div class="name">
        </div>
        <div class="value">
            <a href='https://tech.yandex.ru/money/doc/payment-solution/payment-form/payment-form-docpage/'
               target='_blank'>[`Подробнее о сценариях оплаты`]</a>
        </div>
    </div>
    <div class="field text_inside">
        <div class="name">
            <label for=""></label>
        </div>
        <div class="value">
            <input {if $ya_kassa_paylogo} checked="checked" {/if} id="ya_kassa_paylogo" type="checkbox"
            name="ya_kassa_paylogo" class="input" value="1">
            <label for="ya_kassa_paylogo">[`Назвать кнопку оплаты «Заплатить через Яндекс»`]</label><br/>
        </div>
        <div class="value">
            <input {if isset($ya_kassa_installments_button) && $ya_kassa_installments_button} checked="checked" {/if} id="ya_kassa_installments_button" type="checkbox"
            name="ya_kassa_installments_button" class="input" value="1">
            <label for="ya_kassa_installments_button">[`Добавить кнопку «Заплатить по частям» на страницу оформления заказа`]</label><br/>
        </div>
        <div class="value">
            <label style="padding-left: 20px;">
                <input {if isset($ya_kassa_add_installments_block) && $ya_kassa_add_installments_block} checked="checked" {/if} type="checkbox"
                name="ya_kassa_add_installments_block" class="input" value="1">
                [`Добавить блок «Заплатить по частям» в карточки товаров`]
            </label><br/>
        </div>
    </div>
    <div class="field kassa_methods">
        <div class="name">
            <label for=""></label>
        </div>
        <div class="value">
            <input{if $ya_kassa_wallet} checked="checked" {/if} id="ya_kassa_wallet" type="checkbox"
            name="ya_kassa_wallet" class="input" value="1">
            <label for="ya_kassa_wallet">[`Яндекс.Деньги `]</label><br/>
            <input{if $ya_kassa_card} checked="checked" {/if} id="ya_kassa_card" type="checkbox" name="ya_kassa_card"
            class="input" value="1">
            <label for="ya_kassa_card">[`Банковские карты — Visa, Mastercard и Maestro, «Мир»`]</label><br/>
            <input{if $ya_kassa_terminal} checked="checked" {/if} id="ya_kassa_terminal" type="checkbox"
            name="ya_kassa_terminal" class="input" value="1">
            <label for="ya_kassa_terminal">[`Наличные `]</label><br/>
            <input{if $ya_kassa_wm} checked="checked" {/if} id="ya_kassa_wm" type="checkbox" name="ya_kassa_wm"
            class="input" value="1">
            <label for="ya_kassa_wm">[`Webmoney`]</label><br/>
            <input{if $ya_kassa_sber} checked="checked" {/if} id="ya_kassa_sber" type="checkbox" name="ya_kassa_sber"
            class="input" value="1">
            <label for="ya_kassa_sber">[`Сбербанк Онлайн`]</label><br/>
            <input{if $ya_kassa_alfa} checked="checked" {/if} id="ya_kassa_alfa" type="checkbox" name="ya_kassa_alfa"
            class="input" value="1">
            <label for="ya_kassa_alfa">[`Альфа-Клик.`]</label><br/>
            <input{if $ya_kassa_qw} checked="checked" {/if} id="ya_kassa_qw" type="checkbox" name="ya_kassa_qw"
            class="input" value="1">
            <label for="ya_kassa_qw">[`QIWI Wallet`]</label><br/>
            <input{if isset($ya_kassa_installments) && $ya_kassa_installments} checked="checked" {/if}
            id="ya_kassa_installments" name="ya_kassa_installments" type="checkbox" class="input" value="1">
            <label for="ya_kassa_installments">[`Заплатить по частям`]</label><br/>
            <label style="padding-left: 20px;">
                <input {if isset($ya_kassa_add_installments_block) && $ya_kassa_add_installments_block} checked="checked" {/if} type="checkbox"
                name="ya_kassa_add_installments_block" class="input" value="1">
                [`Добавить блок «Заплатить по частям» в карточки товаров`]
            </label><br/>
        </div>
    </div>
    <div class="field">
        <div class="name">
            <label for="ya_kassa_description_template">[`Описание платежа`]</label>
        </div>
        <div class="value">
            <input id="ya_kassa_description_template" type="text" name="ya_kassa_description_template" class="input"
                   value="{$ya_kassa_description_template}">
            <br><span class="help-block">[`Это описание транзакции, которое пользователь увидит при оплате, а вы — в личном кабинете Яндекс.Кассы. Например, «Оплата заказа №72».<br>
Чтобы в описание подставлялся номер заказа (как в примере), поставьте на его месте %id% (Оплата заказа №%id%).<br>
Ограничение для описания — 128 символов.`]</span>
        </div>
    </div>
    <div class="field">
        <div class="name">
            <label for="ya_kassa_enable_hold_mode">[`Включить отложенную оплату`]</label>
        </div>
        <div class="value">
            <input id="ya_kassa_enable_hold_mode" name="ya_kassa_enable_hold_mode" type="checkbox" class="input"
                   value="1" {if $ya_kassa_enable_hold_mode} checked="checked" {/if}>
            [`Если опция включена, платежи с карт проходят в 2 этапа: у клиента сумма замораживается, и вам вручную нужно подтвердить её списание – через панель администратора. <a href="https://kassa.yandex.ru/features-pre-authorisation.html" target="_blank">Подробное описание Холдирования.</a>`]
        </div>
    </div>
    <div class="hold_mode_settings" style="display: none; overflow:hidden; padding-left: 30px;">
        <div class="field">
            <label>[`Какой статус присваивать заказу, если он:`]</label><br/>
            <div class="name">
                <label for="ya_kassa_hold_order_status">[`ожидает подтверждения`]</label>
            </div>
            <div class="value">
                <select name="ya_kassa_hold_order_status" id="ya_kassa_hold_order_status" class="fixed-width-xl">
                    {foreach $ya_kassa_states_list as $key => $item}
                    <option {if $ya_kassa_hold_order_status == $key} selected="selected" {/if}
                    value="{$key}">{$item}</option>
                    {/foreach}
                </select>
                <br><span class="help-block">[`заказ переходит в этот статус при поступлении и остается в нем пока оператор магазина не подтвердит или не отменит платеж`]</span>
            </div>
        </div>
    </div>

    <div class="field">
        <div class="name">
            <label for="ya_kassa_send_check">[`Отправлять в Яндекс.Кассу данные для чеков (54-ФЗ)`]</label>
        </div>
        <div class="value">
            <input {if $ya_kassa_send_check} checked="checked" {/if} id="ya_kassa_send_check" type="radio"
            name="ya_kassa_send_check" class="input" value="1">
            <label for="ya_kassa_send_check">[`Включить`]</label><br/>
            <input {if !$ya_kassa_send_check} checked="checked" {/if} id="ya_kassa_send_check" type="radio"
            name="ya_kassa_send_check" class="input" value="0">
            <label for="ya_kassa_send_check">[`Отключить`]</label><br/>
        </div>
    </div>
    <div class="tax_settings" style="display: none; overflow:hidden; padding-left: 30px;">
        <div class="field">
            <label for="ya_kassa_default_vat_code">[`Ставка по умолчанию`]</label><br/>
            <select name="ya_kassa_default_vat_code" class="fixed-width-xl" id="ya_kassa_default_vat_code">
                {foreach $ya_kassa_tax_list as $key => $tax_item}
                    <option {if $ya_kassa_default_vat_code == $key} selected="selected" {/if}
                        value="{$key}">{$tax_item}</option>
                {/foreach}
            </select>
            <br><span class="help-block">[`Ставка по умолчанию будет в чеке, если в карточке товара не указана другая ставка`]</span>
        </div>
        <label>[`Сопоставьте ставки`]</label>
        <div class="field">
            <div class="name">
                <span class="help-block">[`Ставка в вашем магазине`]</span>
            </div>
            <div class="value">
                <span class="help-block">[`Ставка для чека в налоговую`]</span>
            </div>
        </div>
        {foreach $taxes as $tax}
        <div class="field">
            <div class="name">
                <label for="ya_kassa_tax_{$tax['id']}">{$tax['name']}</label>
            </div>
            <div class="value">
                <select name="ya_kassa_tax_{$tax['id']}" class="fixed-width-xl" id="ya_kassa_tax_{$tax['id']}">
                    {foreach $ya_kassa_tax_list as $key => $tax_item}
                        <option {if isset($ya_kassa_tax_{$tax['id']}) && $ya_kassa_tax_{$tax['id']} == $key} selected="selected" {/if}
                         value="{$key}">{$tax_item}</option>
                    {/foreach}
                </select>
            </div>
        </div>
        {/foreach}
    </div>
    <div class="field">
        <div class="name">
            <label>[`Url для нотификаций`]</label>
        </div>
        <div class="value">
            <input type="text" value="{$ya_kassa_callback}" readonly>
            <br><span class="help-block">[`Этот адрес понадобится, только если его попросят специалисты Яндекс.Кассы`]</span>
        </div>
    </div>
    <div class="field">
        <div class="name">
            <label for="">[`Запись отладочной информации`]</label>
        </div>
        <div class="value">
            <input {if $ya_kassa_log} checked="checked" {/if} id="ya_kassa_log" type="checkbox" name="ya_kassa_log"
            class="input" value="1">
            <br><span class="help-block">[`Настройку нужно будет поменять, только если попросят специалисты Яндекс.Денег`]</span>
        </div>
    </div>
    <div class="field">
        <div class="value submit save_data">
            <input type="submit" class="button green" value="Save">
            <span id="plugins-settings-form-status" style="display:none"><!-- message placeholder --></span>
        </div>
    </div>
</form>
<script>
    function hideTaxes() {
        if ($('input[name="ya_kassa_send_check"]:checked').val() === "1") {
            $('.tax_settings').slideDown('slow');
        } else {
            $('.tax_settings').slideUp('slow');
        }
    }
    function toggleHoldSettingsBlock() {
        if ($('input[name="ya_kassa_enable_hold_mode"]:checked').val() === "1") {
            $('.hold_mode_settings').slideDown('slow');
        } else {
            $('.hold_mode_settings').slideUp('slow');
        }
    }

    $(document).ready(function () {
        hideTaxes();
        toggleHoldSettingsBlock();
        $('input[name="ya_kassa_send_check"]').change(function () {
            hideTaxes();
        });
        $('input[name="ya_kassa_enable_hold_mode"]').change(function () {
            toggleHoldSettingsBlock();
        });

        $('input[name=ya_kassa_add_installments_block]').on('change', function () {
            var checked = this.checked;
            $('input[name=ya_kassa_add_installments_block]').each(function() {
                this.checked = checked;
            });
        });
    });
</script>